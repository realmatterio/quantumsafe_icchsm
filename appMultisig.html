<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTUM-SAFE ICCHSM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --cyber-blue: #00f3ff;
            --cyber-pink: #ff00ff;
            --cyber-dark: #1a1a2e;
            --cyber-glow: 0 0 10px var(--cyber-blue);
        }

        body {
            background: linear-gradient(135deg, var(--cyber-dark) 0%, #000 100%);
            color: #fff;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
        }

        .section {
            border: 1px solid var(--cyber-blue);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            position: relative;
            transition: all 0.3s ease;
            background: rgba(26, 26, 46, 0.7);
            backdrop-filter: blur(5px);
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 15px;
            border: 1px solid transparent;
            background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-pink));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        .section.active {
            box-shadow: 0 0 20px var(--cyber-pink);
        }

        .section-title {
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--cyber-dark);
            padding: 0 15px;
            color: var(--cyber-blue);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 20px;
            border: 1px solid var(--cyber-blue);
            box-shadow: var(--cyber-glow);
        }

        .cyber-button {
            background: transparent;
            border: 1px solid var(--cyber-blue);
            color: var(--cyber-blue);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 25px;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .cyber-button:hover {
            background: var(--cyber-blue);
            color: var(--cyber-dark);
            box-shadow: 0 0 15px var(--cyber-blue);
        }

        .cyber-button.active {
            background: var(--cyber-blue);
            color: var(--cyber-dark);
            box-shadow: 0 0 15px var(--cyber-blue);
        }

        .cyber-input {
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid var(--cyber-blue);
            color: #fff;
            padding: 0.75rem;
            width: 100%;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .cyber-input:focus {
            outline: none;
            box-shadow: 0 0 15px var(--cyber-blue);
        }

        pre {
            background: rgba(0, 243, 255, 0.1);
            padding: 1rem;
            overflow-x: auto;
            margin: 0.5rem 0;
            border-radius: 10px;
            border: 1px solid var(--cyber-blue);
        }

        .quick-nav {
            display: flex;
            overflow-x: auto;
            gap: 0.5rem;
            padding: 1rem;
            background: rgba(0, 243, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .title-glow {
            text-shadow: 0 0 10px var(--cyber-blue);
            color: var(--cyber-blue);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--cyber-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--cyber-blue);
            border-radius: 4px;
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--cyber-blue), transparent);
            margin: 1rem 0;
        }
    </style>
</head>
<body class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl text-center mb-6 title-glow font-bold">QUANTUM-SAFE ICCHSM</h1>

    <!-- Quick Navigation -->
    <div class="quick-nav mb-6">
        <button class="cyber-button" onclick="scrollToSection('pqc-method')">PQC Method</button>
        <button class="cyber-button" onclick="scrollToSection('hsm-input')">HSM & Input</button>
        <button class="cyber-button" onclick="scrollToSection('multisig')">Multisig</button>
        <button class="cyber-button" onclick="scrollToSection('key-encap')">Key Encap</button>
        <button class="cyber-button" onclick="scrollToSection('did-cred')">DID Cred</button>
    </div>

    <!-- Section 1: PQC Method -->
    <div id="pqc-method" class="section">
        <span class="section-title">Select PQC Method</span>
        
        <h2 class="mb-4 title-glow">NIST Signature Method</h2>
        <div class="flex flex-wrap gap-2 mb-4">
            <button class="cyber-button active" data-group="signature" data-value="sphincsplus-simple">Sphincs+</button>
            <button class="cyber-button" data-group="signature" data-value="dilithium">Dilithium</button>
            <button class="cyber-button" data-group="signature" data-value="falcon">Falcon</button>
        </div>

        <h2 class="mb-4 title-glow">NIST Encryption Method</h2>
        <div class="flex flex-wrap gap-2 mb-4">
            <button class="cyber-button" data-group="encryption" data-value="kyber">Kyber ML-KEM</button>
            <button class="cyber-button" data-group="encryption" data-value="cm">Classic McEliece</button>
            <button class="cyber-button active" data-group="encryption" data-value="mm">Modern McEliece</button>
        </div>

        <h2 class="mb-2 title-glow">Selected Quantum-Safe Key</h2>
        <pre id="quantumSafeKey">ckm-icc-shake256-mm-sphincsplus-simple</pre>
    </div>

    <!-- Section 2: HSM & Input -->
    <div id="hsm-input" class="section">
        <span class="section-title">Load HSM Key and Input</span>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block mb-2">HSM SLOT:</label>
                <input type="text" id="slot" value="1209011109" class="cyber-input"/>
                <div class="flex gap-2 mt-2">
                    <button class="cyber-button" onclick="setSlot('1209011109')">1209011109</button>
                    <button class="cyber-button" onclick="setSlot('1661660599')">1661660599</button>
                </div>
            </div>
            <div>
                <label class="block mb-2">PIN:</label>
                <input type="text" id="pin" value="4321" class="cyber-input"/>
                <label class="block mb-2 mt-4">ID:</label>
                <input type="text" id="id" value="322601A" readonly class="cyber-input"/>
            </div>
        </div>

        <button id="showKey" class="cyber-button w-full mb-4">Load Key</button>
        
        <h3 class="mb-2 title-glow">All Keys in Slot</h3>
        <pre id="slotConsoleOutput"></pre>

        <div class="mt-4">
            <label class="block mb-2">Input message:</label>
            <input type="text" id="message" class="cyber-input"/>
            <div class="flex gap-2 mt-2">
                <button id="saveMessage" class="cyber-button">ENTER</button>
                <button id="hashMessage" class="cyber-button">HASH</button>
            </div>
        </div>

        <h3 class="mt-4 title-glow">Hashed Content</h3>
        <pre id="hashedContent"></pre>
    </div>

    <!-- Section 3: Quantum-safe Multisig -->
    <div id="multisig" class="section">
        <span class="section-title">Quantum-safe Multisig</span>
        
        <button id="signMessage" class="cyber-button w-full mb-4">Sign Message</button>
        
        <h2 class="mb-2 title-glow">Quantum-Safe Sign</h2>
        <pre id="signConsoleOutput"></pre>
        
        <h3 class="mt-4 title-glow">Signature Content</h3>
        <pre id="signatureContent"></pre>

        <button id="verifySignature" class="cyber-button w-full mt-4">Verify Signature</button>
        <pre id="verifyConsoleOutput" class="mt-4"></pre>
    </div>

    <!-- Section 4: Quantum-safe Key Encapsulation -->
    <div id="key-encap" class="section">
        <span class="section-title">Quantum-safe Key Encapsulation</span>
        
        <button id="encryptMessage" class="cyber-button w-full mb-4">Encrypt Hashed Message</button>
        
        <h2 class="mb-2 title-glow">Quantum-Safe Encrypt</h2>
        <pre id="encryptConsoleOutput"></pre>
        
        <h3 class="mt-4 title-glow">Encrypted Content</h3>
        <pre id="encryptedContent"></pre>

        <div class="divider"></div>

        <button id="decryptMessage" class="cyber-button w-full mb-4">Decrypt Message</button>
        
        <h2 class="mb-2 title-glow">Quantum-Safe Decrypt</h2>
        <pre id="decryptConsoleOutput"></pre>
        
        <h3 class="mt-4 title-glow">Decrypted Binary Content</h3>
        <pre id="decryptedContent"></pre>
    </div>

    <!-- Section 5: On-chain DID Credential -->
    <div id="did-cred" class="section">
        <span class="section-title">On-chain DID Credential</span>
        
        <h2 class="mb-2 title-glow">Multisig DID</h2>
        <pre id="didCredential">None</pre>

        <button id="makeDIDCredential" class="cyber-button w-full my-4">Make Multisig DID Credential</button>

        <h3 class="mb-2 title-glow">Constructed Verifiable Credential</h3>
        <pre id="multisigCredential">None</pre>

        <button id="writeBlockchain" class="cyber-button w-full my-4">Write Blockchain</button>
        
        <h3 class="mb-2 title-glow">Quantumeum Blockchain Console</h3>
        <pre id="blockchainOutput"></pre>

        <div class="flex gap-4 mt-4">
            <button class="cyber-button flex-1" onclick="window.open('https://quantumeum.web.app/qscanner', '_blank')">
                Go to Blockchain
            </button>
            <button class="cyber-button flex-1" onclick="goToCredential()">
                Go to Credential
            </button>
        </div>
    </div>

    <footer class="text-center mt-8 text-cyber-blue">
        Real Matter Technology Limited 2025 Feb
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Function to handle section highlighting
        function activateSection(sectionId) {
            $('.section').removeClass('active');
            $(`#${sectionId}`).addClass('active');
        }

        // Function to scroll to section
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.scrollIntoView({ behavior: 'smooth' });
            activateSection(sectionId);
        }

        // Function to set slot
        function setSlot(value) {
            document.getElementById("slot").value = value;
        }

        // Function to go to credential
        function goToCredential() {
            let didCredential = $("#didCredential").text().trim();
            if (didCredential && didCredential !== 'None') {
                window.open('https://quantumeum.web.app/qvisa/' + didCredential, '_blank');
            } else {
                alert("Please generate a DID Credential first!");
            }
        }

        $(document).ready(function() {
            // Add input focus handlers for section activation
            $('.section input, .section button').on('focus click', function() {
                const sectionId = $(this).closest('.section').attr('id');
                activateSection(sectionId);
            });

            // ID mapping for mechanism combinations
            const idMapping = {
                'ckm-icc-shake256-mm-falcon': '322600B',
                'ckm-icc-shake256-kyber-falcon': '322600C',
                'ckm-icc-shake256-cm-falcon': '3226010',
                'ckm-icc-shake256-mm-dilithium': '3226012',
                'ckm-icc-shake256-kyber-dilithium': '3226013',
                'ckm-icc-shake256-cm-dilithium': '3226014',
                'ckm-icc-shake256-mm-sphincsplus-simple': '322601A',
                'ckm-icc-shake256-kyber-sphincsplus-simple': '322601B',
                'ckm-icc-shake256-cm-sphincsplus-simple': '322601C'
            };

            $('.cyber-button[data-group="signature"][data-value="sphincsplus-simple"]').addClass('active');
            $('.cyber-button[data-group="encryption"][data-value="mm"]').addClass('active');
            updateKeyAndId();

            $('.cyber-button[data-group]').click(function() {
                let group = $(this).data('group');
                let value = $(this).data('value');

                $(`.cyber-button[data-group='${group}']`).removeClass('active');
                $(this).addClass('active');

                updateKeyAndId();
            });

            function updateKeyAndId() {
                let signature = $('.cyber-button[data-group="signature"].active').data('value');
                let encryption = $('.cyber-button[data-group="encryption"].active').data('value');

                if (signature && encryption) {
                    let key = `ckm-icc-shake256-${encryption}-${signature}`;
                    $('#quantumSafeKey').text(key);
                    let newId = idMapping[key] || '';
                    if (newId) {
                        $('#id').val(newId);
                    } else {
                        console.warn('No mapping found for mechanism: ' + key);
                    }
                }
            }

            // Show Key
            $('#showKey').click(function() {
                const data = {
                    slot: $('#slot').val(),
                    pin: $('#pin').val()
                };
                $.ajax({
                    url: 'https://34.30.179.29:5000/show_key',
                    method: 'POST',
                    data: data,
                    success: function(response) {
                        $('#slotConsoleOutput').text(response.console_log);
                    },
                    error: function(xhr, status, error) {
                        $('#slotConsoleOutput').text('Error: ' + error);
                    }
                });
            });

            // Save Message
            $('#saveMessage').click(function() {
                const message = $('#message').val();
                $.ajax({
                    url: 'https://34.30.179.29:5000/write_message',
                    method: 'POST',
                    data: { message },
                    success: function(response) {
                        alert(response.status);
                    },
                    error: function(xhr, status, error) {
                        alert('Error: ' + error);
                    }
                });
            });

            // Hash Message
            $('#hashMessage').click(function() {
                $.ajax({
                    url: 'https://34.30.179.29:5000/hash_message',
                    method: 'POST',
                    success: function(response) {
                        $('#hashedContent').text(response.binary_content || response.error);
                    },
                    error: function(xhr, status, error) {
                        $('#hashedContent').text('Error: ' + error);
                    }
                });
            });

            // Sign Message
            $('#signMessage').click(function() {
                const data = {
                    slot: $('#slot').val(),
                    pin: $('#pin').val(),
                    id: $('#id').val(),
                    mechanism: $('#quantumSafeKey').text()
                };
                $.ajax({
                    url: 'https://34.30.179.29:5000/sign_message',
                    method: 'POST',
                    data: data,
                    success: function(response) {
                        $('#signConsoleOutput').text(response.console_log);
                        $.get('https://34.30.179.29:5000/read_signature', function(data) {
                            $('#signatureContent').text(data.content || 'No signature found');
                        });
                    },
                    error: function(xhr, status, error) {
                        $('#signConsoleOutput').text('Error: ' + error);
                    }
                });
            });

            // Verify Signature
            $('#verifySignature').click(function() {
                const data = {
                    slot: $('#slot').val(),
                    pin: $('#pin').val(),
                    id: $('#id').val(),
                    mechanism: $('#quantumSafeKey').text()
                };
                $.ajax({
                    url: 'https://34.30.179.29:5000/verify_signature',
                    method: 'POST',
                    data: data,
                    success: function(response) {
                        $('#verifyConsoleOutput').text(response.console_log);
                    },
                    error: function(xhr, status, error) {
                        $('#verifyConsoleOutput').text('Error: ' + error);
                    }
                });
            });

            // Encrypt Message
            $('#encryptMessage').click(function() {
                const data = {
                    slot: $('#slot').val(),
                    pin: $('#pin').val(),
                    id: $('#id').val(),
                    mechanism: $('#quantumSafeKey').text()
                };
                $.ajax({
                    url: 'https://34.30.179.29:5000/encrypt_message',
                    method: 'POST',
                    data: data,
                    success: function(response) {
                        $('#encryptConsoleOutput').text(response.console_log);
                        $.get('https://34.30.179.29:5000/read_encrypted', function(data) {
                            $('#encryptedContent').text(data.content || 'No encrypted content');
                        });
                    },
                    error: function(xhr, status, error) {
                        $('#encryptConsoleOutput').text('Error: ' + error);
                    }
                });
            });

            // Decrypt Message
            $('#decryptMessage').click(function() {
                const data = {
                    slot: $('#slot').val(),
                    pin: $('#pin').val(),
                    id: $('#id').val(),
                    mechanism: $('#quantumSafeKey').text()
                };
                $.ajax({
                    url: 'https://34.30.179.29:5000/decrypt_message',
                    method: 'POST',
                    data: data,
                    success: function(response) {
                        $('#decryptConsoleOutput').text(response.console_log);
                        $.get('https://34.30.179.29:5000/read_decrypted', function(data) {
                            $('#decryptedContent').text(data.content || 'No decrypted content');
                        });
                    },
                    error: function(xhr, status, error) {
                        $('#decryptConsoleOutput').text('Error: ' + error);
                    }
                });
            });

            // DID Credential Generation
            $('#makeDIDCredential').click(function() {
                let hashedContent = $('#hashedContent').text().trim();
                let signConsoleOutput = $('#signConsoleOutput').text().trim();
                let quantumKey = $('#quantumSafeKey').text().trim();
                let didCredential = 'did-icchsm-rsa-' + hashedContent;

                $('#didCredential').text(didCredential);

                const credentialData = {
                    '@context': 'ICCHSM Multisig Credential V1 JS',
                    'cName': 'Quantum-Safe Multisig',
                    'claim': {
                        'did-icchsm-rsa': hashedContent,
                        'muitiSig': signConsoleOutput,
                        'quantumKey': quantumKey
                    },
                    'contract': {
                        'method': 'Enhancing RSA signatures with iconCAP Quantum-Safe multisig, embedding hashed signatures into DIDs, and securing validation via Verifiable Credentials on Real Matter blockchain.',
                        'developer': '01 Communique Lab with Real Matter Technology'
                    },
                    'proofSignature': '0x813caf1d9b115cf3d8d36de1696f9a44c7620274eb656e7e7721e22be54f72cd793dd9e3512453bf1dbd42005617d06af5ec970a2b2bd34725034561eea6ba5d1b',
                    'publicKey': '0x0425c80f2d99b888584a19a7253bf47b65094640e5cfb2489d79b00955849b50ee55a0046e131375c0028eef5c97e1b40e2465ff270111bca578f83390915b222a'
                };

                $('#multisigCredential').text(JSON.stringify(credentialData, null, 2));
            });

            // Write to Blockchain
            $('#writeBlockchain').click(function() {
                let didCredential = $('#didCredential').text().trim();
                let dMessage = $('#multisigCredential').text().trim();

                if (!didCredential || dMessage === 'None') {
                    alert('Please generate the DID Credential first!');
                    return;
                }

                const blockchainData = {
                    command: 'createVc',
                    dMessage: JSON.parse(dMessage),
                    from: 'quantumeum',
                    to: didCredential,
                    zHash: '0x0e22c3c000bca18388a982dd56f7c34e90abb753de674e22dfa6f9b1f9511276',
                    zSignature: '0xfc156067858c608434f3c3360381d99bbfda72a49020af65410304da754db6991b26fabdc4dfafa6098ddd98f1c3c598abc8f357d4743fe22ad76387b7aef2ae1c'
                };

                $.ajax({
                    url: 'https://httprequest-3wfs3qaqoa-uc.a.run.app',
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(blockchainData),
                    success: function(response) {
                        $('#blockchainOutput').text(JSON.stringify(response, null, 2));
                    },
                    error: function(error) {
                        $('#blockchainOutput').text('Error: ' + JSON.stringify(error, null, 2));
                    }
                });
            });
        });
    </script>
  </body>
</html>

                